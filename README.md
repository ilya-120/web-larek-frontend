# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

Проект "Веб-ларек" - интернет-магазин с товарами для веб-разработчиков. Пользователь может просматривать каталог товаров, добавить товары в корзину и делать заказы.. Проект реализован на TypeScript и представляет собой SPA (Single Page Application) с использованием API для получения данных о товарах и заказах.

## Описание интерфейса

Интерфейс можно условно разделить на 3 процесса:
1. Просмотр списка товаров.
2. Выбор товара и добавление в корзину.
3. Оформление заказа.

## Описание архитектуры проекта

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.
 
Код приложения разделен на слои согласно парадигме MVP:

- слой представления - View, отвечает за отображение данных на странице.
- слой данных - Model, отвечает за хранение и изменение данных.
- презентер - Presenter, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Поля:

- `baseUrl: string` - базовый URL для запросов.
- `options: RequestInit` - объект опций для запросов.

Конструктор:

В конструктор передается адрес сервера и опциональный объект с заголовками запросов.

- `constructor(baseUrl: string, options: RequestInit = {})` - принимает базовый URL и глобальные опции для всех запросов(опционально).

Методы:

- `handleResponse(response: Response): Promise<object>` - защищенный метод принимает и обрабатывает ответ сервера.
- `get(uri: string)` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

Поля:

- `_events: Map<EventName, Set<Subscriber>>` - приватное свойство, содержащее карту "вид события - набор подписчиков".

Конструктор:

В конструкторе инициализируется свойство _events. При вызове свойств туда будут записываться новые события и подписчики на них.

Основные методы, реализуемые классом описаны интерфейсом IEvents:

- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - подписка на событие.
- `off(eventName: EventName, callback: Subscriber)` - позволяет снять обработчик с события.
- `emit<T extends object>(eventName: string, data?: T)` - инициализация события.
- `onAll(callback: (event: EmitterEvent) => void)` - подписка на все события.
- `offAll()` - позволяет снять обработчики со всех событий.
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Component

Абстрактный класс, служит в качестве базового компонента для работы с DOM.

Поля:

- `container` - контейнер, в который помещается компонент интерфейса.

Конструктор:

В конструкторе принимается в качестве аргумента DOM-элемент контейнера, который он сохраняет в защищенном свойстве.

Методы:

- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - переключить класс.
- `setText(element: HTMLElement, value: unknown)` - установить текстовое содержимое.
- `setDisabled(element: HTMLElement, state: boolean)` - сменить статус блокировки.
- `setHidden(element: HTMLElement)` - метод, позволяющий визуально скрыть элемент.
- `setVisible(element: HTMLElement)` - метод, позволяющий визуально отобразить элемент.
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - установить изображение с алтернативным текстом.
- `render(data?: Partial<T>): HTMLElement` - метод, возвращающий корневой DOM-элемент.

#### Класс Model

Абстрактный класс базовой модели.

Поля:

- `events: IEvents` - защищенное свойство, хранящее события.

Конструктор:

- `constructor(data: Partial<T>, protected events: IEvents) {}` - переданные в конструктор данные копируются в инстансы класса. Таким образом, для дочерних классов нет необходимости переопределять конструктор.

Методы:

- `emitChanges(event: string, payload?: object)` - Сообщить всем что модель поменялась.

### Слой данных

#### Класс AppState

Класс отвечает за управление состоянием каталога продуктов, корзины, заказа и ошибки форм.

Поля:

- `_catalog: Product[]` - массив объектов товаров.
- `_selectedProduct: Product | null` - товар, выбранный для просмотра в модальной окне.
- `_order: Order | null` - текущий заказ.
- `_basket: Product[] | null` - корзина с добавленными товарами.
- `preview: string | null` - содержит id товара, открытого для  предварительного просмотра.
- `formErrors: FormErrors` - содержит ошибки формы.

Методы:

- `selectProduct(item: IProduct): void` - метод, меняющий выбранный товар, в случае открытия его описания.
- `addProduct(item: IProduct): void` - отвечает за добавление товара в корзину.
- `removeProduct(item: IProduct): void` - отвечает за удаление товара из корзины.
- `refreshBasket(): void` - отвечает за обновление корзины и счетчика при добавлении и удалении товаров.
- `setOrderField(field: keyof IOrderForm, value: string)` - отвечает за передачу данных из формы заказа.
- `setContactField(field: keyof IContactsForm, value: string)` - отвечает за передачу данных из формы контактов.
- `clearBasket(): void` - отвечает за очистку корзины.
- `clearOrder(): void` - очищает данные заказа.
- `getBasketTotal(): number` - позволяет получить количество товаров в корзине.
- `validateContact()` - отвечает за валидацию данных в форме контактов.
- `validateOrder()` - отвечает за валидацию данных в заказе.
- `setCatalog(): Promise<Product[]>` - устанавливает каталог продуктов.

#### Класс ShopApi

Представляет API для взаимодействия с сервером (наследуемый от Api).

Поля :

- `cdn: string` - URL адрес CDN сервера.

Конструктор:

- `constructor(baseUrl: string, cdn: string, options?: RequestInit) {}` - создает новый экземпляр класса, принимая URL CDN сервера, базовый URL и опции запроса.

Методы:

- `getProductList` - получает список продуктов с сервера.
- `getProduct` - получает конкретный продукт с сервера.
- `orderProducts` - отправляет заказ на сервер и возвращает ответ.


### Слой представления

#### Класс Page

Класс главного экрана приложения (наследуемый от Component).

Поля:

- `_counter: HTMLElement` - DOM-элемент, в котором будет отображаться количество товаров в корзине.
- `_gallery: HTMLElement` - DOM-элемент для отображения каталога товаров.
- `_pageWrapper: HTMLElement` - DOM-элемент, являющийся оболочкой страницы; необходим, чтобы заблокировать прокрутку страницы.
- `_basket: HTMLElement` - DOM-элемент для отображения корзины.

Конструктор:

- `constructor(container: HTMLElement, protected events: IEvents) {)` - В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве.

Методы:
- `handleBasketClick` - добавляется слушатель на клик по корзине.
Сеттеры:
- `set counter(value: number)` - устанавливает количество товаров в корзине.
- `set catalog(items: HTMLElement[])` - устанавливает товары в каталог.
- `set locked(value: boolean)` - позволяет заблокировать страницу для прокрутки.


#### Класс Card

Этот класс реализует карточку товара (наследуемый от Component).

Класс хранит такие данные, как:
- категория товара
- изображение товара
- цена товара;

Поля:

- `_title: HTMLElement` - DOM-элемент для отображения названия товара.
- `_price: HTMLElement` - DOM-элемент для отображения цены.
- `_image: HTMLImageElement` - DOM-элемент для отображения картинки.
- `_description: HTMLElement` - DOM-элемент для отображения описания товара.
- `_button: HTMLButtonElement` - DOM-элемент для отображения кнопки "В коризну"
- `_category: HTMLElement` - DOM-элемент для отображения категории товара.
- `_index: HTMLElement` - DOM-элемент для отображения индекса карточки, находящейся в корзине.

Конструктор:

- `constructor(container: HTMLElement, actions?: ICardActions) {}` - В качестве аргументов принимает контейнер для поиска и опционально объект действий. В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве. Также добавляются слушатели на клики.

Методы (Cеттеры, геттеры):

- `set id(value: string)` и `get id(): string` - позволяют установить и получить id товара.
- `set title(value: string)` и `get title(): string` - позволяют установить и получить название товара.
- `set image(value: string)` - позволяет установить изображение товара.
- `set price(value: number | null)` - позволяет установить цену товара.
- `set category(value: CategoryType)` - позволяет установить категорию товара.
- `set description(value: string)` - устанавливает описание товара.
- `set basketIndex(value: number)` - устанавливает номер по порядку для товаров в корзине.


#### Класс Modal

Этот класс реализует модальное окно (наследуемый от Component).

Поля:

- `_closeButton: HTMLButtonElement` - DOM-элемент кнопки закрытия модального окна.
- `_content: HTMLElement` - DOM-элемент для отображения контента.

Конструктор:

- `constructor(container: HTMLElement, protected events: IEvents) {}` - В качестве аргументов принимает контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также доабвляются слушатели на клики.

Методы:

- `set content(value: HTMLElement)` - сеттер для установки контента.
- `open()` - метод для открытия.
- `close()` - метод для закрытия.
- `render()` - метод для отрисовки.


#### Класс Basket

Этот класс реализует корзину товаров (наследуемый от Component).

Поля:

- `_list: HTMLElement` - DOM-элемент для отображения списка товаров.
- `_total: HTMLElement` - DOM-элемент для отображения итоговой суммы.
- `_button: HTMLButtonElement` - DOM-элемент для отображения кнопки.

Конструктор:

- `constructor(container: HTMLElement, protected events: EventEmitter) {}` - В качестве аргументов принимает название блока, контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на клик по кнопке офорления заказа.

Методы (сеттеры):

- `set total(price: number)` - сеттер для установки стоимости товаров в корзине
- `set items(items: HTMLElement[])` - для установки отображаемых в корзине товаров.

#### Класс Form

Этот класс управляет состоянием формы, обработкой полей ввода, ошибок и отправки на сервер (наследуемый от Component).

Поля:

- `_submit: HTMLButtonElement` - DOM-элемент кнопки отправки данных формы.
- `_errors: HTMLElement` - DOM-элемент, в котором будут отображаться ошибки валидации.

Конструктор

- `constructor(protected container: HTMLFormElement, protected events: IEvents) {}` - В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатели на сабмит и инпут формы.

Методы:

- `onInputChange(field: keyof T, value: string)` - защищенный метод для события введения данных пользователем.
- `set valid(value: boolean)` - деактивирует кнопку сабмита, если данные в форме валидны.
- `set errors(value: string)` - добавляет ошибки валидации.
- `render(state: Partial<T> & IFormState)` - отрисовка формы.

#### Класс Order

Этот класс реализует форму заказа с выбором способа оплаты и адреса доставки (наследуемый от Form).

Поля:

- `_card: HTMLButtonElement` - кнопка для выбора способа оплаты: онлайн.
- `_cash: HTMLButtonElement` - кнопка для выбора способа оплаты: при получении.
- `_address: HTMLInputElement` - поле ввода адреса.

Конструктор:

- `constructor(container: HTMLFormElement, events: IEvents) {` - В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляются слушатели на кнопки выбора способа оплаты и инпут адреса.

Методы (сеттеры):

- `set address(value: string)` - сеттер для адреса.
- `set payment(value: PaymentMethods)` - сеттер для способа оплаты.


#### Класс Contacts

Этот класс реализует форму для ввода контактной информации (наследуемый от Form).

Поля:

- `_email: HTMLInputElement` - DOM-элемент инпута почты.
- `_phone: HTMLInputElement` - DOM-элемент инпута телефона.

Конструктор:

- `constructor(container: HTMLFormElement, events: IEvents) {}` - В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляются слушатели инпуты.

Методы:

- `set email(value: string)` - сеттер для почты.
- `set phone(value: string)` - сеттер для телефона.


#### Класс Success

Этот класс выводит сообщения об успешном выполнении заказа (наследуемый от Component).

Поля:

- `_close` - кнопка для закрытия сообщения об успехе.
- `_description` - элемент для отображения описания успешного заказа.

Конструктор:

- `constructor(container: HTMLElement, actions: ISuccessActions) {}` - В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на кнопку.

Методы:

Наследует методы от Component.

### Презентер События, возникающие при взаимодействии пользователя с интерфейсом.

- items:changed - обновление списка продуктов
- modal:openModal - открытие модального окна
- modal:closeModal - закрытие модального окна
- product:add - добавление товара в корзину
- product:delete - удаление товара из корзины
- basket:changed - обновление интерфейса корзины
- counter:changed - обновление счетика корзины
- order:changed - изменения в заказе
- address:change - изменение адреса
- contacts:change - изменение контактов
- errors:changed - ошибка формы
- order:submit - подтверджение формы оплаты
- contacts:submit - подтверджение формы контактов
- payment:toggle - смена способа оплаты

### Данные и типы данных, используемые в приложении

#### Интерфейс для модели данных товара
```
export interface IProduct {
  id: string;
  title: string;
  description: string;
  category: string;
  price: number;
  image: string;
}
```

#### Интерфейс для модели данных заказа
```
export interface IOrder {
  items: string[];
  total: number;
  email: string;
  phone: string;
  address: string;
  payment: string;
}
```

#### Интерфейс для обработки ответа при оформлении заказа
```
export interface IOrderSuccess {
  id: string;
  total: number;
}
```

#### Тип данных для обработки ошибки
```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```
